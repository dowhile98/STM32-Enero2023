/*
 * AT_Parser.c
 *
 *  Created on: 6 feb. 2023
 *      Author: jeffr
 */

#include "lwrb.h"
#include <stdio.h>
#include <string.h>
#include "stm32f4xx.h"



void rb_evt_fn(lwrb_t* buff, lwrb_evt_type_t type, size_t len){

	switch (type) {
		case LWRB_EVT_RESET:
			printf("[EVT] Buffer reset event!\r\n");
			break;
		case LWRB_EVT_READ:
			printf("[EVT] Buffer read event: %d byte(s)!\r\n", (int)len);
			break;
		case LWRB_EVT_WRITE:
			printf("[EVT] Buffer write event: %d byte(s)!\r\n", (int)len);
			break;
	        default: break;
	    }

}

void at_send_cmd(uint8_t *cmd, uint32_t timout){
	uint32_t tickstart = GetTick();
	uint32_t len = strlen((char*)cmd);
	while(len>0){
		if(USART2->SR & USART_SR_TXE){
			USART2->DR = *cmd;
			cmd++;
			len--;
		}
		if((GetTick() - tickstart)>timout){
			break;
		}
	}
}

bool at_verify_response(uint8_t *response){

}
